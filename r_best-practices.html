<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-04-17 Tue 01:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Best practices in R</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Marie-Hélène Burle" />
<style type="text/css">
<!--/*--><![CDATA[/*><!--*/
@media all
{
  article,
  aside,
  details,
  figcaption,
  figure,
  footer,
  header,
  hgroup,
  nav,
  section,
  summary {
    display: block;
  }
  audio,
  canvas,
  video {
    display: inline-block;
  }
  audio:not([controls]) {
    display: none;
    height: 0;
  }
  [hidden] {
    display: none;
  }
  html {
    font-family: sans-serif;
    -webkit-text-size-adjust: 95%;
    -ms-text-size-adjust: 95%;
  }
  body {
    margin: 0;
  }
  a:focus {
    outline: thin dotted;
  }
  a:active,
  a:hover {
    outline: 0;
  }
  abbr[title] {
    border-bottom: 1px dotted;
  }
  b,
  strong {
    font-weight: bold;
  }
  dfn {
    font-style: italic;
  }
  mark {
    background: #ff0;
    color: #000;
  }
  code,
  kbd,
  pre,
  samp {
    font-family: monospace, serif;
    font-size: 1em;
  }
  pre,
  code {
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  q {
    quotes: "\201C" "\201D" "\2018" "\2019";
  }
  small {
    font-size: 80%; 
  }
  sub,
  sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
  }
  sup {
    top: -0.5em;
  }
  sub {
    bottom: -0.25em;
  }
  img {
    border: 0;
  }
  svg:not(:root) {
    overflow: hidden;
  }
  figure {
    margin: 0;
  }
  fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
  }
  legend {
    border: 0;
    padding: 0;
  }
  button,
  input,
  select,
  textarea {
    font-family: inherit;
    font-size: 100%;
    margin: 0;
  }
  button,
  input {
    line-height: normal;
  }
  button,
  html input[type="button"],
  input[type="reset"],
  input[type="submit"] {
    -webkit-appearance: button;
    cursor: pointer;
  }
  button[disabled],
  input[disabled] {
    cursor: default;
  }
  input[type="checkbox"],
  input[type="radio"] {
    box-sizing: border-box;
    padding: 0;
  }
  input[type="search"] {
    -webkit-appearance: textfield;
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box;
    box-sizing: content-box;
  }
  input[type="search"]::-webkit-search-cancel-button,
  input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
  }
  button::-moz-focus-inner,
  input::-moz-focus-inner {
    border: 0;
    padding: 0;
  }
  textarea {
    overflow: auto;
    vertical-align: top;
  }
  table {
    border-collapse: collapse;
    border-spacing: 0;
  }
  html {
    font-family: 'Lato', sans-serif;
    font-size: 110%;
  }
  pre,
  code {
    font-family: 'Inconsolata', sans-serif;
  }
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: 'Lato', sans-serif;
    font-weight: 700;
  }
  h1 {
    line-height: 50px;
    padding: 20px 0px 10px 0px;
  }
  h2 {
    line-height: 35px;
    padding: 20px 0px 0px 0px;
  }
  h3 {
    line-height: 31px;
    padding: 15px 0px 0px 0px;
  }
  h4 {
    line-height: 25px;
  }
  h5 {
    line-height: 20px;    
  }
  h6 {
    line-height: 15px;
  }
  html {
    background-color: #faf9f1;
    color: #242b2f;
    margin: 1em;
    line-height: 24px;
  }
  body {
    background-color: #faf9f1;
    margin: 0px auto 0px 150px;
    max-width: 21.5cm;
    /* border: 1pt solid #93a1a1; */
    /* border: 1pt solid #d9d9d9; */
    /* border: 1pt solid #c9cfcf; */
    /* border-radius: 10px; */
    padding: 1em;
  } 
  a {
    color: #b58900;
  }
  a:visited {
    color: #cb4b16;
  }
  a:hover {
    color: #e65719;
  }
  h1 {
    color: #890c0c;
  }
  h2 {
    color: #19334d;
  }
  h3 {
    color: #336699;
  }
  h4 {
    color: #6699cc;
  }
  h5 {
    color: #666666;
  }
  h6 {
    color: #808080;
  }
  pre[class="src src-R"] {	/*for blocks src R*/
    background-color: #f1f1f1;
    color: #262626;
    padding: 0.8em;
    font-size: 95%;
    line-height: 22px;
    border: 0.5pt solid #d9d9d9;
    border-radius: 5px;
    box-shadow: 0pt 0pt 0pt #eee8d5;
  }
  code {			/*for inline code*/
    background-color: #f1f1f1;
    color: #262626;
    padding: 0em 0.2em 0em 0.2em;
    font-size: 95%;
    line-height: 22px;
    border: 0.5pt solid #e6e6e6;
    border-radius: 3px;
    box-shadow: 0pt 0pt 0pt #eee8d5;
  }
  blockquote {			/*for block quote*/
    /* font: 14px/22px normal helvetica, sans-serif; /\*original line*\/ */
    line-height: 22px;
    font-style: italic;
    margin: 30px 0px 30px 50px;
    padding-left: 15px;
    border-left: 3px solid #ccc;
  }
  pre[class="example"] {	/*for block example*/
    background-color: #f0efe7;
    font-family: 'Rokkitt';
    width: max-content;
    color: #3e3e3e;
    padding: 0.6em 0.8em 0.6em 0.8em;
    /* font-size: 95%; */
    line-height: 22px;
    border: 0.5pt solid #ebeae0;
    border-radius: 5px;
    box-shadow: 0pt 0pts 0pt #eee8d5;
  }
  p[class="verse"] {		/*for block verse*/
    color: #262626;
    font-family: 'IM Fell English';
    font-size: 110%;
    font-style: italic;
    /* margin-left: 30px;		/\*keep this line to have the verses indented*\/ */
    line-height: 25px;
  }
  div[class="org-center"] {	/*for block center*/
    margin: auto;
    line-height: 22px;
    width: max-content;
  }
  div[class="ASCII"] {		/*for block ascii*/
    font-family: 'Montez';
    line-height: 26px;
    font-size: 130%;
  }
  /* div[class="VERBATIM"] {	/\*for block verbatim*\/ */
  /*   /\* background-color: #f5f4eb; *\/ */
  /*   font-family: 'Anonymous Pro'; */
  /*   margin: auto; */
  /*   width: max-content; */
  /*   color: #000000; */
  /*   /\* padding: 0.05em 0.8em 0.05em 0.8em; *\/ */
  /*   font-size: 88%; */
  /*   line-height: 20px; */
  /*   /\* border: 0.5pt solid #d9d9d9; *\/ */
  /*   /\* border-radius: 5px; *\/ */
  /* } */
  div[class="VERBATIM"] {	/*for block verbatim*/
    line-height: 22px;
    /* font-weight: bold; */
    margin: 45px 0px 45px 200px;
    /* padding-left: 10px; */
    /* border-left: 3px solid #890c0c; */
    font-size: 135%;
    color: #7c6262;
  }
  .org-ess-numbers {
    color: #e28200; 
  }
  .org-comment-delimiter {
    color: #8c8c8c;
  }
  .org-comment {
    color: #8c8c8c;
  }
  .org-string {
    color: #013b6d;
  }
  .org-ess-function-call {
    color: #bf4040;
    /* font-weight: bolder; */
  }
  .org-ess-operator {
    color: #0b5e56;
  }
  .org-ess-assignment {
    color: #0b5e56;
  }
  .org-ess-paren {
    color: #0b5e56;
  }
  .org-ess-XopX {
    color: #0b5e56;
  }  
  h1 {
    font-size: 2.2em;
    text-align: center;
  }
  h2 {
    font-size: 1.6em;
  }
  h3 {
    font-size: 1.5em;
  }
  h4 {
    font-size: 1.4em;
  }
  h5 {
    font-size: 1.3em;
  }
  h6 {
    font-size: 1.2em;
  }
  .tag {
    background-color: #eee8d5;
    color: #d33682;
    padding: 0 0.2em;
  }
  .todo,
  .next,
  .done {
    color: #faf9f1;
    background-color: #dc322f;
    padding: 0 0.2em;
  }
  .tag {
    -webkit-border-radius: 0.35em;
    -moz-border-radius: 0.35em;
    border-radius: 0.35em;
  }
  .TODO {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #2aa198;
  }
  .NEXT {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #268bd2;
  }
  .ACTIVE {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #268bd2;
  }
  .DONE {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #859900;
  }
  .WAITING {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #cb4b16;
  }
  .HOLD {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #d33682;
  }
  .NOTE {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #d33682;
  }
  .CANCELLED {
    -webkit-border-radius: 0.2em;
    -moz-border-radius: 0.2em;
    border-radius: 0.2em;
    background-color: #859900;
  }

  /* TOC inspired by http://jashkenas.github.com/coffee-script */
  #table-of-contents {
    font-size: 10pt;
    position: fixed;
    right: 0em;
    top: 0em;
    background: #faf9f1;
    color: #596a73;
    /* -webkit-box-shadow: 0 0 1em #777777; */
    /* -moz-box-shadow: 0 0 1em #777777; */
    /* -webkit-border-bottom-left-radius: 10px; */
    /* -moz-border-radius-bottomleft: 10px; */
    text-align: right;
    /* ensure doesn't flow off the screen when expanded */
    max-height: 80%;
    overflow: auto;
  }
  #table-of-contents h2 {
    font-size: 12pt;
    max-width: 25em;
    font-weight: bold;
    color: #596a73;
    padding-right: 3em;
    padding-left: 0.8em;
    padding-top: 1em;
    padding-bottom: 0em;
    text-align: left;
  }
  #table-of-contents #text-table-of-contents {
    display: none;
    text-align: left;
  }
  #table-of-contents:hover #text-table-of-contents {
    display: block;
    padding: 0.5em;
    margin-top: -1.5em;
  }

  .rss_box {}
  .rss_title, rss_title a {}
  .rss_items {}
  .rss_item a:link, .rss_item a:visited, .rss_item a:active {}
  .rss_item a:hover {}
  .rss_date {}

} /* END OF @media all */


@media screen
{
  #table-of-contents {
    float: right;
    border: 0px solid #CCC;
    max-width: 25%;
    overflow: auto;
  }
} /* END OF @media screen */
/*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<span style="color:#596a73; font-size:16px"><b>Marie-Hélène Burle</b><br>April 17, 2018</span>
</div>
<div id="content">
<h1 class="title">Best practices in R</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4a7d3a5">1. Self contained projects</a>
<ul>
<li><a href="#org9577d1e">1.1. Example possible project structure</a></li>
<li><a href="#orgeec4eaf">1.2. Relative paths</a></li>
</ul>
</li>
<li><a href="#orgf4ffd2a">2. Clean session</a></li>
<li><a href="#org23cafbc">3. Formatting</a></li>
</ul>
</div>
</div>

<div id="outline-container-org4a7d3a5" class="outline-2">
<h2 id="org4a7d3a5"><span class="section-number-2">1</span> Self contained projects</h2>
<div class="outline-text-2" id="text-1">
<div class="VERBATIM">
<p>
Work in projects.<br />
</p>

</div>

<p>
If you use RStudio, create RStudio projects. If you don't, still create projects.<br />
</p>

<p>
→ Create a folder that will contain the entirety of your project.<br />
</p>
</div>

<div id="outline-container-org9577d1e" class="outline-3">
<h3 id="org9577d1e"><span class="section-number-3">1.1</span> Example possible project structure</h3>
<div class="outline-text-3" id="text-1-1">
<p>
A project structure could look like this:<br />
</p>

<pre class="example">
/project_root    - /data      - /raw
                                    - /clean
                     - /results
                     - /docs
                     - /bin
                     - /src
                     - /ms
</pre>
</div>
</div>

<div id="outline-container-orgeec4eaf" class="outline-3">
<h3 id="orgeec4eaf"><span class="section-number-3">1.2</span> Relative paths</h3>
<div class="outline-text-3" id="text-1-2">
<p>
All paths used in any of your scripts should be relative to the project root. Why? Because that way, your project is <i>portable</i>. Something crucial for collaborations through GitHub, GitLab, Bitbucket, etc., or for someone to whom you would give the project, and, let's not forget, for future you.<br />
</p>

<p>
As <a href="https://github.com/jennybc">Jenny Bryan</a> put it in her excellent <a href="https://www.tidyverse.org/articles/2017/12/workflow-vs-script/">blog</a> about this example code with an absolute path:<br />
</p>

<div class="org-src-container">
<pre class="src src-R"><span class="org-ess-function-call">setwd</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-string">"/Users/jenny/cuddly_broccoli/verbose_funicular/foofy/data"</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
df <span class="org-ess-assignment">&lt;-</span> <span class="org-ess-function-call">read.delim</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-string">"raw_foofy_data.csv"</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>

<blockquote>
<p>
"The chance of the setwd() command having the desired effect – making the file paths work – for anyone besides its author is 0%. It’s also unlikely to work for the author one or two years or computers from now. "<br />
</p>
</blockquote>

<p>
There are various ways to use relative paths, but my favourite is to use the package <a href="https://github.com/r-lib/here">here</a> from <a href="https://github.com/krlmlr">Kirill Müller</a>. The function <code class="src src-R"><span class="org-ess-function-call">here</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">()</span></span></code> starts from the working directory and walks up the directory path until it finds a <code class="src src-R">.Rproj</code> file (if you use RStudio projects), a <code class="src src-R">.git</code> or <code class="src src-R">.svn</code> folder (if you version control your projects), a <code class="src src-R">.projectile</code> file (if you use emacs projectile), or other sensible files/folders which signify a project root. If you do not have any of these files, you can create a file <code class="src src-R">.here</code> in your project root with the function <code class="src src-R"><span class="org-ess-function-call">set_here</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">()</span></span></code> (this should be unnecessary for the vast majority of people).<br />
</p>

<p>
From there on, you will refer to <i>any</i> file in your project by <code class="src src-R"><span class="org-ess-function-call">here</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-string">"file-path-from-project-root"</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span></code>.<br />
</p>

<p>
Now, you can move the project anywhere and the paths will still work, while any absolute path would get broken the minute you move the project to another machine.<br />
</p>

<p>
The project functions as a self-contained unit (of course, R and your R libraries live elsewhere. But these will be called properly on another machine so it is not an issue).<br />
</p>

<p>
Example script:<br />
</p>

<div class="org-src-container">
<pre class="src src-R"><span class="org-ess-modifiers">library</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>tidyverse<span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span> <span class="org-comment-delimiter"># </span><span class="org-comment">for readxl</span>
<span class="org-ess-modifiers">library</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span>here<span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>      <span class="org-comment-delimiter"># </span><span class="org-comment">obviously you have to install the package first</span>

my_var <span class="org-ess-assignment">&lt;-</span> <span class="org-ess-function-call">read_excel</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-ess-function-call">here</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-string">"data/raw/my-super-data.xlsx"</span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-ess-paren"><span class="org-rainbow-delimiters-depth-1">)</span></span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf4ffd2a" class="outline-2">
<h2 id="orgf4ffd2a"><span class="section-number-2">2</span> Clean session</h2>
<div class="outline-text-2" id="text-2">
<p>
Never save your workspace upon closing a session (beware of RStudio settings!) and restart your R session frequently. This is the only way to make sure your script actually works and you aren't seeing the result of a combination of unreproducible bits of code from past sessions.<br />
</p>

<p>
Also, do not add anything in your <code class="src src-R">.Rprofile</code> that would affect your code in any way, such as setting options, creating functions, loading packages, etc.<br />
</p>
</div>
</div>

<div id="outline-container-org23cafbc" class="outline-2">
<h2 id="org23cafbc"><span class="section-number-2">3</span> Formatting</h2>
<div class="outline-text-2" id="text-3">
<p>
<a href="http://hadley.nz/">Hadley Wickham</a> wrote a <a href="http://style.tidyverse.org/">short book</a> on R formatting. You do not have to agree with his formatting style as there is no official R formatting rule. However, with the increasing popularity of the <code class="src src-R">tidyverse</code> and his efforts to standardize what is otherwise totally chaotic in R, adopting his style might be a good idea.<br />
</p>

<p>
<b>In any event, whatever style you choose, the most important point is to be consistent.</b><br />
</p>

<p>
If you edit someone else's code, follow <i>their</i> style so that the document remains consistent.<br />
</p>
</div>
</div>
</div>
</body>
</html>
